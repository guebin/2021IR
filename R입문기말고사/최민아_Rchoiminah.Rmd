---
title: "Rchoiminah"
author: "최민아"
date: '2021 12 21 '
output: html_document
---

```{r}
library(tidyverse)
```

## `1`. 회귀분석 (35점) 

아래와 같은 수식을 고려하자. 

$$y_i= 1.5+ 5\sin(t_i)+ 3 \cos(4 t_i)+\epsilon_i, \quad i=1,2,\dots, 1000$$

여기에서 $t_i=\frac{2\pi i}{1000}$ 이다. 그리고 $\epsilon_i \sim i.i.d~ N(0,1)$, 즉 서로 독립인 표준정규분포에서 추출된 샘플이다. 

#### `(1)` `rnorm()`을 이용하여 $\{\epsilon_i \}_{i=1}^{1000}$ 을 만들고 이를 벡터로 만들어라. 즉 아래와 같은 벡터를 생성하라. 

- $\boldsymbol{\epsilon}=(\epsilon_1,\dots,\epsilon_{1000})$

```{r}
epsilon_i <- rnorm(1000, 0, 1)
epsilon_i

```


#### `(2)` $\big\{\sin(t_i) \big\}_{i=1}^{1000}$와 $\big\{\cos(4t_i) \big\}_{i=1}^{1000}$를 각각 생성하고 이를 ${\bf x}_1$와 ${\bf x}_2$에 저장하라. 즉 아래와 같은 2개의 벡터를 생성하라. 
- ${\bf x}_1=\big(\sin(\frac{2\pi}{1000}),\sin(\frac{4\pi}{1000}),\dots,\sin(2\pi)\big)$
- ${\bf x}_2=\big(\cos(\frac{8\pi}{1000}),\cos(\frac{16\pi}{1000}),\dots,\cos(8\pi)\big)$

```{r}
#x1
i <- 1:1000
t_i <- i*pi/500
x1 <- sin(t_i)
print(x1)
```

```{r}
#x2
x2 <- cos(4*t_i)
print(x2)
```


#### `(3)` (1),(2)로 부터 $y_i$를 계산하고, $(t_i,y_i)$를 scatter plot으로 시각화 하라. 색은 'gray60'을 사용하라. 시각화 예시는 아래와 같다. 

![](https://github.com/guebin/2021IR/blob/master/_notebooks/final_fig1.png?raw=true)

```{r}
y <- 1.5+5*x1+3*x2+epsilon_i
plot(t_i, y, col='gray60', lwd='3', cex=2)
```


#### `(4)` 두 벡터 ${\bf x}_1$, ${\bf x}_2$와 `cbind()`를 이용하여 아래와 같은 $1000 \times 3$ 매트릭스 ${\bf X}$를 만들어라. 

$${\bf X}=\begin{bmatrix}
1 & \sin(\frac{2\pi}{1000}) & \cos(\frac{8\pi}{1000})\\ 
1 & \sin(\frac{4\pi}{1000}) & \cos(\frac{16\pi}{1000})\\ 
\dots & \dots  & \dots \\ 
1 & \sin(2\pi) & \cos(8\pi)\\ 
\end{bmatrix} $$ 

```{r}
X <- cbind(1,x1,x2)
Xtb=as_tibble(X)
Xtb
```


#### `(5)` $3 \times 1$ 매트릭스 $\boldsymbol{\beta}=\begin{bmatrix} 1.5 \\ 5 \\ 3 \end{bmatrix}$를 만들고 매트릭스 곱을 이용하여 ${\bf X} {\boldsymbol \beta}$를 계산하라. 계산결과를 벡터화하고 (3)의 $y$축에 붉은선으로 시각화 하라. 시각화 예시는 아래와 같다. (필요하다면 적절하게 선의 굵기를 조정할 것) 

![](https://github.com/guebin/2021IR/blob/master/_notebooks/final_fig2.png?raw=true)

```{r}
B <- rbind(1.5, 5, 3)
Btb=as_tibble(B)
Btb
```
```{r}
XB <- X %*% B
XB
```
```{r}
plot(t_i, y, col='gray60', lwd='3', cex=2)
lines(t_i, XB, col='red', lwd='8')
```



#### `(6)` 아래의 수식을 이용하여 $\boldsymbol{\hat\beta}$를 계산하고 계산결과를 $\boldsymbol{\beta}$와 비교하라. 

$$ \boldsymbol{\hat\beta} = ({\bf X}^\top {\bf X})^{-1}{\bf X}^\top {\bf y}$$ 

여기에서 ${\bf X}$와 ${\bf y}$는 각각 아래와 같다. 

- ${\bf X}=\begin{bmatrix}
1 & \sin(\frac{2\pi}{1000}) & \cos(\frac{4\pi}{1000})\\ 
1 & \sin(\frac{8\pi}{1000}) & \cos(\frac{16\pi}{1000})\\ 
\dots & \dots  & \dots \\ 
1 & \sin(2\pi) & \cos(8\pi)\\ 
\end{bmatrix}$,  $\quad {\bf y}=\begin{bmatrix} y_1\\ y_2\\ \dots \\ y_{1000}\\ \end{bmatrix}$

또한 ${\bf X}^\top$는 ${\bf X}$의 전치행렬(transpose) 그리고 $({\bf X}^\top {\bf X})^{-1}$은 ${\bf X}^\top {\bf X}$의 역행렬을 의미한다. 
```{r}
y <- 1.5+5*x1+3*x2+epsilon_i
y1 <- cbind(y)
XT <- rbind(1, x1, x2)
XT
```
```{r}
#X^TX = XTX
XTX <- XT%*%X
XTX
```
```{r}
#X^TX 역행렬 = XTX1
XTX1 <- solve(XTX)
XTX1
```
```{r}
#역행렬X^T
XTX2 <- XTX1%*%XT
XTX2
```
```{r}
#XTX2y
B_hat <- XTX2 %*% y1
B_hat
```





#### `(7)` ${\bf X}\boldsymbol{\hat\beta}$를 계산하라. 계산결과를 벡터화 하고 (5)의 시각화 결과에 푸른점선으로 시각화 하라. 시각화 예시는 아래와 같다. (필요하다면 적절하게 선의 굵기를 조정할 것) 

![](https://github.com/guebin/2021IR/blob/master/_notebooks/final_fig3.png?raw=true)

```{r}
vec <- X%*%B_hat
vec
```
```{r}
plot(t_i, y, col='gray60', lwd='3', cex=2)
lines(t_i, XB, col='red', lwd='8')
lines(t_i, vec, col='blue', lty=4, lwd='8')
```



## `2`. 몬테카를로 적분 (10점)

#### `(1)` $\int_{-1.96}^{1.96}\frac{1}{\sqrt{2\pi}}e^{-\frac{1}{2}x^2}dx$의 값을 `runif()`를 이용한 몬테카를로 적분으로 계산하라. 

```{r}
#우함수이기 때문에 (0, 1.96)구간에서의 적분값을 2배 해준다.
exp(-1.96^2/2)/sqrt(2*pi)
#가로 2 세로 1 임의의 점 뿌리기 - 전체 점읭 수와 함수 아래 점의 수 세기
```
```{r}
x=seq(from=0, to=2, by=0.01)
y=exp(-x^2/2)/sqrt(2*pi)
xx=runif(10000)*2
yy=runif(10000)
plot(xx,yy, cex=2)
```
```{r}
plot(xx,yy)
lines(x, y, col='red',lwd=4)
```
```{r}
test = function(xx,yy){
    yy < exp(-xx^2/2)/sqrt(2*pi)
}
print(c(xx[1],yy[1]))
print(exp(-xx[1]^2/2)/sqrt(2*pi))
test(xx[1],yy[1])
```
```{r}
plot(xx,yy,col='gray')
lines(x,y,col='red',lwd=3)
points(xx[1],yy[1],col='blue')
points(xx[1],exp(-xx[1]^2/2)/sqrt(2*pi),col='red')
```
```{r}
tst = c()
for(i in 1:10000) {
    tst[i]=test(xx[i],yy[i])
}
head(tst)
```
```{r}
plot(xx,yy,col='gray')
lines(x,y,col='red',lwd=3)
points(xx[tst],yy[tst],col='red')
```
```{r}
tst1 <- sum(tst)
#넓이
2*tst1/10000
```

#### `(2)` `rnorm()`을 이용하여 표준정규분포에서 1000개의 확률변수를 생성하고 생성된 확률변수들 중 구간 $(-1.96 , 1.96)$사이에 있는 확률변수를 count하라. 

```{r}
A <- rnorm(1000, 0, 1)
A
```
```{r}
(A>-1.96 & A<1.96) %>% sum
```

## `3`. 징검다리 (10점)

10명의 참가자가 (유리,강화유리)의 쌍으로 이루어진 징검다리를 건너는 게임을 시작한다. (유리,강화유리)의 쌍은 총 20개 있다. 따라서 유리는 총 40장이 있다. 참가자는 강화유리로 된 징검다리를 밟으면 살아남지만 유리로 된 징검다리를 밟으면 죽는다. 10명의 참가자의 특징은 아래와 같다. 

- 1번~8번 참가자, 10번 참가자: 50퍼센트의 확률로 강화유리를 고를 수 있다. 
- 9번 참가자: 95퍼센트의 확률로 강화유리를 고를 수 있다. 

다리를 건너는 순서는 아래와 같이 번호의 오름차순으로 건너는 방법과 번호의 내림차순으로 건너는 2가지 방법이 있다고 하자. 

- Type A: 10번 참가자부터 다리를 건너고 그 뒤로 9번, 8번, ... 1번 순으로 다리를 건넌다. 
- Type B: 1번 참가자부터 다리를 건너고 그 뒤로 2번, 3번, ... 10번 순으로 다리를 건넌다. 

8번 참가자는 Type A 와 Type B 중 어떠한 경우에 살아남을 확률이 높은가? 

```{r}

```

## `4`. COVID19 (15점)

아래는 한국의 코로나확진자 발생수를 tibble로 불러오는 코드와 그 결과이다. 

df=read_csv('https://raw.githubusercontent.com/guebin/2021IR/master/_notebooks/covid19.csv')
head(df)

```{r}
df <- read.csv("https://raw.githubusercontent.com/guebin/2021IR/master/_notebooks/covid19.csv", fileEncoding = "UTF-8", encoding = "CP949")
head(df)
```

#### `(1)` 2020년의 확진자(cases)총합과 2021년의 확진자(cases)총합을 구하라.

```{r}
DF <- as_tibble(df)
DF
```
```{r}
colnames(DF)
```
```{r}
DF %>% select(cases)  %>% sum
```


#### `(2)` 2020년 2월1일 ~ 2020년 2월15일까지의 기간동안 확진자의 합을 지역별로 나누어 구하라 (아래예시 참고). 가장 많은 확진자가 발견된 지역은 어디인가? 

즉 아래를 각각 계산하고 2020년 2월1일 ~ 2020년 2월15일 기간동안 발생한 확진자의 합이 가장 큰 지역을 찾으면 된다. 

- 2020년2월1일 ~ 2020년2월15일 기간 서울에서 발생한 확진자의 합 = 2021년2월1일 서울에서 발생한 확진자수 + ... + 2021년2월15일 서울에서 발생한 확진자수
- ...
- 2020년2월1일 ~ 2020년2월15일 기간 제주에서 발생한 확진자의 합 = 2021년2월1일 재주에서 발생한 확진자수 + ... + 2021년2월15일 제주에서 발생한 확진자수

```{r}
#서울
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='서울') %>% select(cases) %>% sum
```
```{r}
#부산
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='부산') %>% select(cases) %>% sum
```
```{r}
#대구
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='대구') %>% select(cases) %>% sum
```
```{r}
#인천
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='인천') %>% select(cases) %>% sum
```
```{r}
#광주
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='광주') %>% select(cases) %>% sum
```
```{r}
#대전
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='대전') %>% select(cases) %>% sum
```
```{r}
#울산
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='울산') %>% select(cases) %>% sum
```
```{r}
#세종
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='세종') %>% select(cases) %>% sum
```
```{r}
#경기
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='경기') %>% select(cases) %>% sum
```
```{r}
#강원
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='강원') %>% select(cases) %>% sum
```
```{r}
#충북
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='충북') %>% select(cases) %>% sum
```
```{r}
#충남
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='충남') %>% select(cases) %>% sum
```
```{r}
#전북
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='전북') %>% select(cases) %>% sum
```
```{r}
#전남
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='전남') %>% select(cases) %>% sum
```
```{r}
#경북
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='경북') %>% select(cases) %>% sum
```
```{r}
#경남
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='경남') %>% select(cases) %>% sum
```
```{r}
#제주
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='제주') %>% select(cases) %>% sum
```
```{r}
#검역
DF %>% filter(year==2020 & month==2) %>% filter(day<16) %>% filter(prov=='검역') %>% select(cases) %>% sum
```


서울 5 부산 0 대구 0 인천 0 광주 2 대전 0 울산 0 세종 0 경기 9 강원 0 충북 0 충남 0 전북 0 전남 1 경북 0 경남 0 제주 0 검역 0


### 경기 지역 확진자가 9명으로 제일 많다.


#### `(3)` 2020년 2월16일 ~ 2020년 2월29일까지의 기간동안 확진자의 총합을 지역별로 나누어 구하라 (아래예시 참고). 가장 많은 확진자가 발견된 지역은 어디인가?

즉 아래를 각각 계산하고 2020년 2월16일 ~ 2020년 2월29일 기간동안 발생한 확진자의 합이 가장 큰 지역을 찾으면 된다. 

- 2020년2월16일 ~ 2020년2월29일 기간 서울에서 발생한 확진자의 합 = 2021년2월16일 서울에서 발생한 확진자수 + ... + 2021년2월29일 서울에서 발생한 확진자수
- ...
- 2020년2월16일 ~ 2020년2월29일 기간 제주에서 발생한 확진자의 합 = 2021년2월16일 제주에서 발생한 확진자수 + ... + 2021년2월29일 제주에서 발생한 확진자수

```{r}
#서울
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='서울') %>% select(cases) %>% sum
```
```{r}
#부산
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='부산') %>% select(cases) %>% sum
```
```{r}
#대구
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='대구') %>% select(cases) %>% sum
```
```{r}
#인천
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='인천') %>% select(cases) %>% sum
```
```{r}
#광주
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='광주') %>% select(cases) %>% sum
```
```{r}
#대전
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='대전') %>% select(cases) %>% sum
```
```{r}
#울산
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='울산') %>% select(cases) %>% sum
```
```{r}
#세종
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='세종') %>% select(cases) %>% sum
```
```{r}
#경기
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='경기') %>% select(cases) %>% sum
```
```{r}
#강원
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='강원') %>% select(cases) %>% sum
```
```{r}
#충북
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='충북') %>% select(cases) %>% sum
```
```{r}
#충남
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='충남') %>% select(cases) %>% sum
```
```{r}
#전북
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='전북') %>% select(cases) %>% sum
```
```{r}
#전남
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='전남') %>% select(cases) %>% sum
```
```{r}
#경북
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='경북') %>% select(cases) %>% sum
```
```{r}
#경남
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='경남') %>% select(cases) %>% sum
```
```{r}
#제주
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='제주') %>% select(cases) %>% sum
```
```{r}
#검역
DF %>% filter(year==2020 & month==2) %>% filter(day>15 & day<=29) %>% filter(prov=='검역') %>% select(cases) %>% sum
```

서울 62 부산 75 대구 2055 인천 5 광주 7 대전 13 울산 17 세종 1 경기 65 강원 7 충북 10 충남 48 전북 4 전남 1 경북 472 경남 59 제주 2 검역 0


### 대구 지역 확진자가 2055명으로 제일 많다.

